<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>E.D.N. // DESIGN_DASHBOARD</title>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700&family=Outfit:wght@400;700;900&family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    /* --- TRENDY PALETTE & GRADIENTS --- */
    --bg-core: #1F1F1F;
    --grad-core: linear-gradient(135deg, #1F1F1F 0%, #0a0a0a 100%);
    --grad-panel: linear-gradient(180deg, #2E2E2E 0%, #1a1a1a 100%);
    --grad-card: linear-gradient(145deg, #333333 0%, #262626 100%);
    --grad-primary: linear-gradient(135deg, #FF5E14 0%, #FF2E00 100%);
    
    /* --- ACCENTS --- */
    --primary: #FF5E14;       
    --white: #FFFFFF;
    --grey-text: #AAAAAA;
    --line-green: #06C755; /* LINE Brand Color */
    
    /* --- SHAPES --- */
    --radius-lg: 24px;        
    --radius-md: 16px;        
    --radius-pill: 100px;     
    
    /* --- TYPOGRAPHY --- */
    --font-head: 'Outfit', sans-serif;
    --font-body: 'Noto Sans TC', sans-serif;
    --font-ui: 'Manrope', sans-serif;
    
    /* --- Z-INDEX --- */
    --z-nav: 100;
    --z-modal: 200;
    --z-drawer: 150;
    --z-toggle: 140;
  }

  /* RESET */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  
  /* SCROLLBAR */
  ::-webkit-scrollbar { width: 8px; height: 8px; }
  ::-webkit-scrollbar-track { background: #111; }
  ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

  body {
    font-family: var(--font-body);
    background: var(--grad-core);
    color: var(--white);
    height: 100vh;
    overflow: hidden;
    display: flex;
    font-size: 15px;
  }

  /* --- SIDEBAR --- */
  .app-sidebar {
    width: 260px;
    background: transparent;
    display: flex;
    flex-direction: column;
    z-index: var(--z-nav);
    flex-shrink: 0;
    padding: 20px;
  }

  .sidebar-header {
    padding: 10px 10px 30px 10px;
  }

  .brand-logo {
    font-family: var(--font-head);
    font-weight: 900;
    font-size: 24px;
    letter-spacing: -0.02em;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .brand-icon {
    width: 36px; height: 36px;
    background: var(--grad-primary);
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px; font-weight: 900; color: #fff;
    box-shadow: 0 4px 12px rgba(255, 94, 20, 0.3);
  }

  .nav-scroll {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .nav-group-title {
    padding: 0 16px;
    font-family: var(--font-head);
    font-weight: 700;
    font-size: 12px;
    color: var(--grey-text);
    margin-bottom: 8px;
    margin-top: 16px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .nav-item {
    width: 100%;
    text-align: left;
    background: transparent;
    border: none;
    padding: 12px 20px;
    color: var(--white);
    font-family: var(--font-ui);
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-radius: var(--radius-pill); 
    transition: all 0.2s ease;
  }

  .nav-item:hover {
    background: rgba(255, 255, 255, 0.05);
    color: var(--primary);
  }

  .nav-item.active {
    background: var(--white);
    color: #000;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }

  .nav-item-count {
    font-size: 12px;
    opacity: 0.5;
    background: rgba(0,0,0,0.2);
    padding: 2px 8px;
    border-radius: 10px;
  }
  
  .nav-item.active .nav-item-count { 
    opacity: 1; 
    background: #000; 
    color: var(--white); 
  }

  /* --- MAIN CONTENT --- */
  .app-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
    background: var(--grad-panel);
    border-radius: 30px 0 0 30px; 
    box-shadow: -10px 0 40px rgba(0,0,0,0.5);
    margin: 10px 0 10px 0; 
    border-left: 1px solid rgba(255,255,255,0.05);
    border-top: 1px solid rgba(255,255,255,0.05);
  }

  /* --- TOP BAR --- */
  .top-bar {
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 40px;
    flex-shrink: 0;
  }

  .page-title {
    font-family: var(--font-head);
    font-size: 28px;
    font-weight: 800;
    letter-spacing: -0.02em;
    position: relative;
    background: linear-gradient(90deg, #fff, #aaa);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  
  .page-title::after {
    content: '';
    position: absolute;
    bottom: 0px; left: 0;
    width: 100%; height: 6px;
    background: var(--grad-primary);
    z-index: -1;
    opacity: 0.5;
    border-radius: 4px;
    transform: rotate(-1deg);
  }

  /* [NEW] Header Actions Group */
  .header-actions {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  /* [NEW] LINE Button Style */
  .btn-line {
    background: var(--line-green);
    color: #FFF;
    border: none;
    padding: 10px 20px;
    border-radius: var(--radius-pill);
    font-family: var(--font-body);
    font-weight: 700;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(6, 199, 85, 0.3);
    transition: all 0.2s ease;
  }

  .btn-line:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(6, 199, 85, 0.5);
    background: #05B34C;
  }

  .btn-line svg {
    width: 18px;
    height: 18px;
    fill: currentColor;
  }

  .search-wrap {
    position: relative;
    width: 280px;
  }

  .search-wrap input {
    width: 100%;
    background: rgba(0,0,0,0.3);
    border: 2px solid rgba(255,255,255,0.05);
    border-radius: var(--radius-pill);
    padding: 10px 20px 10px 44px;
    color: var(--white);
    font-family: var(--font-ui);
    font-size: 14px;
    outline: none;
    transition: 0.3s;
  }

  .search-wrap input:focus {
    border-color: var(--primary);
    background: #000;
    box-shadow: 0 0 15px rgba(255, 94, 20, 0.1);
  }

  .search-icon {
    position: absolute;
    left: 16px; top: 50%;
    transform: translateY(-50%);
    color: var(--grey-text);
    font-size: 14px;
  }

  /* --- GRID CONTENT --- */
  .content-scroll {
    flex: 1;
    overflow-y: auto;
    padding: 40px;
  }

  .news-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 24px;
  }

  /* --- TRENDY CARD DESIGN --- */
  .trend-card {
    background: var(--grad-card);
    border-radius: var(--radius-lg);
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    display: flex;
    flex-direction: column;
    position: relative;
    border: 1px solid rgba(255,255,255,0.03);
    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
  }

  .trend-card:hover {
    background: var(--grad-primary);
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 40px rgba(255, 94, 20, 0.25);
    border-color: transparent;
  }

  .trend-card:hover .card-title,
  .trend-card:hover .card-meta {
    color: #000;
  }
  
  .trend-card:hover .card-arrow {
    background: #000;
    color: var(--primary);
    transform: rotate(45deg);
  }
  
  .trend-card:hover .card-img img {
    filter: grayscale(0%);
    transform: scale(1.1);
  }

  .card-header {
    padding: 24px 24px 0 24px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  .card-title {
    font-family: var(--font-head);
    font-size: 20px;
    font-weight: 700;
    line-height: 1.3;
    color: var(--white);
    margin-right: 12px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    transition: color 0.3s;
  }

  .card-arrow {
    width: 40px; height: 40px;
    background: var(--white);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    color: #000;
    font-size: 20px;
    flex-shrink: 0;
    transition: all 0.3s;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }

  .card-img-wrap {
    margin: 20px 24px 24px 24px;
    border-radius: var(--radius-md);
    overflow: hidden;
    aspect-ratio: 16/9;
    background: #000;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }

  .card-img-wrap img {
    width: 100%; height: 100%; object-fit: cover;
    transition: transform 0.5s;
    filter: grayscale(30%);
  }

  .card-meta {
    padding: 0 24px 24px 24px;
    display: flex;
    justify-content: space-between;
    font-family: var(--font-ui);
    font-size: 13px;
    color: var(--grey-text);
    font-weight: 600;
    transition: color 0.3s;
    margin-top: auto;
  }

  .cat-pill {
    background: rgba(0,0,0,0.2);
    padding: 4px 10px;
    border-radius: 20px;
    border: 1px solid rgba(255,255,255,0.05);
  }

  /* --- SUMMARY BUTTON (Toggle) --- */
  .summary-toggle {
    position: fixed;
    top: 100px; right: 0;
    background: var(--grad-primary);
    color: #FFF;
    padding: 16px 12px;
    border-radius: 20px 0 0 20px;
    font-family: var(--font-head);
    font-weight: 700;
    writing-mode: vertical-rl;
    text-orientation: mixed;
    cursor: pointer;
    z-index: var(--z-toggle);
    box-shadow: -4px 4px 20px rgba(0,0,0,0.4);
    border: none;
    transition: right 0.3s, transform 0.3s, padding 0.3s;
    display: none; 
    letter-spacing: 0.1em;
  }
  
  .summary-toggle.visible { display: flex; align-items: center; gap: 8px; }
  .summary-toggle:hover { padding-right: 20px; box-shadow: -4px 4px 25px rgba(255, 94, 20, 0.4); }

  /* --- DRAWER (Right Side Panel) --- */
  .summary-drawer {
    position: fixed;
    top: 10px; bottom: 10px; right: 10px;
    width: 500px; 
    background: var(--grad-panel);
    border-radius: 30px;
    z-index: var(--z-drawer);
    transform: translateX(120%);
    transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
    box-shadow: -30px 0 80px rgba(0,0,0,0.6);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.05);
  }

  .summary-drawer.open { transform: translateX(0); }

  .drawer-header {
    padding: 24px 30px;
    background: rgba(0,0,0,0.2);
    display: flex; justify-content: space-between; align-items: center;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }

  .drawer-title {
    font-family: var(--font-head);
    font-size: 20px;
    font-weight: 800;
    color: var(--white);
    display: flex; align-items: center; gap: 10px;
  }

  .drawer-close {
    width: 36px; height: 36px;
    border-radius: 50%;
    background: rgba(255,255,255,0.1);
    color: #fff;
    border: none;
    cursor: pointer;
    font-size: 18px;
    transition: 0.2s;
  }
  .drawer-close:hover { background: var(--primary); color: #000; }

  .drawer-body {
    flex: 1;
    overflow-y: auto;
    padding: 30px;
    background: linear-gradient(180deg, rgba(0,0,0,0.1) 0%, transparent 100%);
  }

  .summary-box {
    background: rgba(0,0,0,0.2);
    border-radius: var(--radius-md);
    padding: 24px;
    margin-bottom: 20px;
    border: 1px solid rgba(255,255,255,0.03);
  }
  
  .summary-label {
    font-family: var(--font-ui);
    font-size: 12px;
    font-weight: 700;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 12px;
    display: block;
  }

  .summary-text {
    line-height: 1.8;
    color: #DDD;
    font-size: 16px;
  }

  /* --- ARTICLE MODAL --- */
  .modal-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(12px);
    z-index: var(--z-modal);
    display: none;
    justify-content: center; 
    align-items: center;
    padding: 20px;
    gap: 20px; 
    opacity: 0; transition: opacity 0.3s;
    overflow-x: auto;
  }
  .modal-overlay.active { display: flex; opacity: 1; }

  .modal-card {
    background: #1a1a1a;
    width: 800px; max-width: 50vw; 
    height: 85vh;
    border-radius: 30px;
    overflow: hidden;
    box-shadow: 0 30px 100px rgba(0,0,0,0.8);
    display: flex;
    flex-direction: column;
    position: relative;
    border: 1px solid rgba(255,255,255,0.1);
    flex-shrink: 0;
    transition: width 0.3s ease;
  }

  .modal-header {
    padding: 24px 32px;
    background: linear-gradient(180deg, #252525 0%, #1a1a1a 100%);
    display: flex; justify-content: space-between; align-items: flex-start;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }
  
  .modal-cat-badge {
    background: var(--grad-primary);
    color: #fff;
    padding: 4px 12px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 12px;
    margin-bottom: 10px;
    display: inline-block;
    box-shadow: 0 4px 10px rgba(255, 94, 20, 0.3);
  }

  .modal-title {
    font-family: var(--font-head);
    font-size: 24px;
    font-weight: 800;
    line-height: 1.3;
  }

  .modal-body {
    flex: 1;
    overflow-y: auto;
    padding: 0;
  }

  .modal-img {
    width: 100%; height: 350px; object-fit: cover;
    mask-image: linear-gradient(to bottom, black 80%, transparent 100%);
  }

  .modal-content {
    padding: 20px 40px 40px 40px;
    font-size: 18px;
    line-height: 1.8;
    color: #CCC;
    max-width: 800px; margin: 0 auto;
  }

  .modal-content p {
    margin-bottom: 24px;
    text-align: justify;
  }

  .modal-footer {
    padding: 20px 32px;
    background: #151515;
    border-top: 1px solid rgba(255,255,255,0.05);
    display: flex; justify-content: flex-end;
  }

  .btn-primary {
    background: var(--white);
    color: #000;
    border: none;
    padding: 14px 28px;
    border-radius: var(--radius-pill);
    font-family: var(--font-head);
    font-weight: 800;
    font-size: 16px;
    cursor: pointer;
    transition: 0.2s;
  }
  .btn-primary:hover:not(:disabled) {
    background: var(--grad-primary);
    color: #fff;
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(255, 94, 20, 0.4);
  }
  .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }

  /* --- INDEPENDENT SUMMARY POPUP --- */
  .summary-popup {
    background: #222; 
    width: 450px; 
    height: 85vh;
    border-radius: 30px;
    display: none;
    flex-direction: column;
    border: 1px solid var(--primary);
    box-shadow: 0 30px 100px rgba(0,0,0,0.8);
    flex-shrink: 0;
    animation: slideInRight 0.4s cubic-bezier(0.19, 1, 0.22, 1) both;
  }

  @keyframes slideInRight {
    from { opacity: 0; transform: translateX(20px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .popup-header {
    padding: 20px 24px;
    background: rgba(255, 94, 20, 0.1);
    border-bottom: 1px solid var(--primary);
    display: flex; align-items: center; gap: 10px;
  }

  .popup-title {
    font-family: var(--font-head);
    font-weight: 800;
    color: var(--primary);
    font-size: 18px;
    letter-spacing: 0.05em;
  }

  .popup-body {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
    font-size: 16px;
    line-height: 1.8;
    color: #EEE;
  }

  .popup-body ul, .popup-body ol {
    padding-left: 20px;
    margin-bottom: 16px;
  }
  .popup-body li {
    margin-bottom: 8px;
  }

  /* --- [NEW] LINE MODAL --- */
  .line-modal-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(8px);
    z-index: 300; /* Higher than normal modals */
    display: none;
    justify-content: center; 
    align-items: center;
    opacity: 0; transition: opacity 0.3s;
    padding: 20px;
  }
  
  .line-modal-overlay.active {
    display: flex; opacity: 1;
  }

  .line-card {
    background: #1a1a1a;
    width: 100%; max-width: 420px;
    border-radius: 30px;
    overflow: hidden;
    box-shadow: 0 30px 100px rgba(6, 199, 85, 0.2);
    border: 1px solid rgba(6, 199, 85, 0.3);
    position: relative;
    text-align: center;
    animation: scaleUp 0.4s cubic-bezier(0.19, 1, 0.22, 1) both;
  }

  @keyframes scaleUp {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
  }

  .line-header {
    background: var(--line-green);
    color: white;
    padding: 30px 20px;
    border-radius: 0 0 50% 50% / 20px;
  }

  .line-header svg {
    width: 48px; height: 48px;
    margin-bottom: 10px;
    fill: currentColor;
  }

  .line-header h2 {
    font-family: var(--font-head);
    font-size: 24px;
    font-weight: 800;
  }

  .line-body {
    padding: 30px;
  }

  .line-body p {
    color: #CCC;
    font-size: 15px;
    line-height: 1.6;
    margin-bottom: 24px;
  }

  .qr-box {
    background: white;
    padding: 16px;
    border-radius: 20px;
    display: inline-block;
    margin-bottom: 10px;
  }

  .qr-box img {
    display: block;
    width: 180px;
    height: 180px;
    background: #f0f0f0; /* Placeholder color */
    border-radius: 10px;
  }

  .line-close {
    position: absolute;
    top: 20px; right: 20px;
    background: rgba(0,0,0,0.2);
    border: none; color: white;
    width: 32px; height: 32px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 16px;
    transition: 0.2s;
  }
  .line-close:hover { background: rgba(0,0,0,0.4); }

  /* --- LOADING --- */
  .loader {
    width: 48px; height: 48px;
    border: 5px solid #FFF;
    border-bottom-color: var(--primary);
    border-radius: 50%;
    display: inline-block;
    box-sizing: border-box;
    animation: rotation 1s linear infinite;
  }
  @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

  /* --- RESPONSIVE --- */
  @media (max-width: 1200px) {
    .modal-card { width: 60%; }
    .summary-popup { width: 35%; }
  }

  @media (max-width: 768px) {
    body { flex-direction: column; height: auto; overflow: auto; }
    .app-sidebar { width: 100%; padding: 10px; background: #1a1a1a; z-index: 100; position: sticky; top:0; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
    .nav-scroll { flex-direction: row; overflow-x: auto; padding-bottom: 10px; gap: 10px; }
    .nav-item { width: auto; white-space: nowrap; padding: 8px 16px; font-size: 14px; background: rgba(255,255,255,0.1); }
    .nav-group-title { display: none; }
    
    .app-main { margin: 0; border-radius: 0; border-top-left-radius: 20px; border-top-right-radius: 20px; overflow: visible; }
    
    /* Responsive Top Bar */
    .top-bar { padding: 20px; flex-direction: column; align-items: flex-start; height: auto; gap: 16px; }
    .header-actions { width: 100%; flex-direction: column; align-items: stretch; gap: 12px;}
    .search-wrap { width: 100%; }
    .btn-line { justify-content: center; } /* Center text in mobile button */
    
    .content-scroll { padding: 20px; overflow: visible; }
    
    .summary-toggle { top: auto; bottom: 30px; border-radius: 20px; writing-mode: horizontal-tb; padding: 12px 20px; right: 20px; }
    .summary-drawer { width: 100%; top: 20px; bottom: 0; right: 0; border-radius: 20px 20px 0 0; transform: translateY(100%); }
    .summary-drawer.open { transform: translateY(0); }

    .modal-overlay { flex-direction: column; justify-content: flex-start; padding: 10px; }
    .modal-card { width: 100%; max-width: 100%; height: auto; max-height: 60vh; }
    .summary-popup { width: 100%; height: auto; max-height: 40vh; }
  }
</style>
</head>
<body>

<nav class="app-sidebar">
  <div class="sidebar-header">
    <div class="brand-logo">
      <div class="brand-icon">E</div>
      <div>E.D.N.</div>
    </div>
  </div>
  
  <div class="nav-scroll" id="navContainer">
    <!-- Nav Items Injected Here -->
  </div>
</nav>

<main class="app-main">
  <div class="top-bar">
    <div class="page-title" id="pageTitle">DASHBOARD</div>
    
    <!-- [NEW] Header Actions Container -->
    <div class="header-actions">
      <!-- LINE Button -->
      <button class="btn-line" id="btnOpenLine">
        <svg viewBox="0 0 24 24">
          <path d="M24 10.304c0-5.369-5.383-9.738-12-9.738-6.616 0-12 4.369-12 9.738 0 4.814 4.269 8.846 10.036 9.608.391.084.922.258 1.057.592.122.303.079.778.039 1.085l-.171 1.027c-.053.303-.242 1.186 1.039.647 1.281-.54 6.911-4.069 9.428-6.967 1.739-1.907 2.572-3.843 2.572-5.992zm-18.988-2.595c.129 0 .234.105.234.234v4.153h2.296c.129 0 .234.105.234.234v.689c0 .129-.105.234-.234.234h-3.219c-.129 0-.234-.105-.234-.234v-5.076c0-.129.105-.234.234-.234h.689zm5.32 5.076c0 .129-.105.234-.234.234h-.689c-.129 0-.234-.105-.234-.234v-5.076c0-.129.105-.234.234-.234h.689c.129 0 .234.105.234.234v5.076zm5.176-5.076c.129 0 .234.105.234.234v5.076c0 .129-.105.234-.234.234h-.689c-.042 0-.082-.012-.116-.033l-2.607-3.483v3.282c0 .129-.105.234-.234.234h-.689c-.129 0-.234-.105-.234-.234v-5.076c0-.129.105-.234.234-.234h.689c.041 0 .08.011.115.032l2.608 3.484v-3.282c0-.129.105-.234.234-.234h.689zm4.231 1.157c.129 0 .234.105.234.234v.689c0 .129-.105.234-.234.234h-2.296v.919h2.296c.129 0 .234.105.234.234v.689c0 .129-.105.234-.234.234h-3.219c-.129 0-.234-.105-.234-.234v-5.076c0-.129.105-.234.234-.234h3.219c.129 0 .234.105.234.234v.689c0 .129-.105.234-.234.234h-2.296v.919h2.296z"/>
        </svg>
        LINE ÂÆòÊñπÂ∏≥Ëôü
      </button>

      <!-- Search Box -->
      <div class="search-wrap">
        <span class="search-icon">üîç</span>
        <input type="text" id="searchInput" placeholder="Search news...">
      </div>
    </div>
  </div>

  <div class="content-scroll">
    <div class="news-grid" id="newsGrid">
      <!-- Cards Injected Here -->
    </div>
  </div>
</main>

<!-- Right Side Summary Button -->
<button class="summary-toggle" id="summaryToggle">
  <span>SUMMARY</span> ‚ûî
</button>

<!-- Summary Drawer (Category Level) -->
<div class="summary-drawer" id="summaryDrawer">
  <div class="drawer-header">
    <div class="drawer-title">
      <span style="color:var(--primary);">‚óè</span> SECTOR SUMMARY
    </div>
    <button class="drawer-close" id="drawerClose">‚úï</button>
  </div>
  <div class="drawer-body" id="drawerContent">
    <!-- Summary Content -->
  </div>
</div>

<!-- Modal Overlay -->
<div class="modal-overlay" id="modalOverlay">
  <!-- Article Card -->
  <div class="modal-card" id="modalCard">
    <div class="modal-header">
      <div style="flex:1;">
        <span class="modal-cat-badge" id="modalCat">CATEGORY</span>
        <div class="modal-title" id="modalTitle">Title</div>
      </div>
      <button class="drawer-close" id="modalClose">‚úï</button>
    </div>
    <div class="modal-body" id="modalBody">
      <!-- Content -->
    </div>
    <div class="modal-footer">
      <button class="btn-primary" id="btnSummarize">GENERATE AI REPORT</button>
    </div>
  </div>

  <!-- Independent Summary Popup -->
  <div class="summary-popup" id="summaryPopup">
    <div class="popup-header">
      <span style="font-size:20px;">‚ö°</span>
      <span class="popup-title">AI INTELLIGENCE</span>
    </div>
    <div class="popup-body" id="summaryPopupBody">
      <!-- Generated Summary Goes Here -->
    </div>
  </div>
</div>

<!-- [NEW] LINE Modal Popup -->
<div class="line-modal-overlay" id="lineModalOverlay">
  <div class="line-card">
    <button class="line-close" id="lineModalClose">‚úï</button>
    <div class="line-header">
      <svg viewBox="0 0 24 24">
        <path d="M24 10.304c0-5.369-5.383-9.738-12-9.738-6.616 0-12 4.369-12 9.738 0 4.814 4.269 8.846 10.036 9.608.391.084.922.258 1.057.592.122.303.079.778.039 1.085l-.171 1.027c-.053.303-.242 1.186 1.039.647 1.281-.54 6.911-4.069 9.428-6.967 1.739-1.907 2.572-3.843 2.572-5.992zm-18.988-2.595c.129 0 .234.105.234.234v4.153h2.296c.129 0 .234.105.234.234v.689c0 .129-.105.234-.234.234h-3.219c-.129 0-.234-.105-.234-.234v-5.076c0-.129.105-.234.234-.234h.689zm5.32 5.076c0 .129-.105.234-.234.234h-.689c-.129 0-.234-.105-.234-.234v-5.076c0-.129.105-.234.234-.234h.689c.129 0 .234.105.234.234v5.076zm5.176-5.076c.129 0 .234.105.234.234v5.076c0 .129-.105.234-.234.234h-.689c-.042 0-.082-.012-.116-.033l-2.607-3.483v3.282c0 .129-.105.234-.234.234h-.689c-.129 0-.234-.105-.234-.234v-5.076c0-.129.105-.234.234-.234h.689c.041 0 .08.011.115.032l2.608 3.484v-3.282c0-.129.105-.234.234-.234h.689zm4.231 1.157c.129 0 .234.105.234.234v.689c0 .129-.105.234-.234.234h-2.296v.919h2.296c.129 0 .234.105.234.234v.689c0 .129-.105.234-.234.234h-3.219c-.129 0-.234-.105-.234-.234v-5.076c0-.129.105-.234.234-.234h3.219c.129 0 .234.105.234.234v.689c0 .129-.105.234-.234.234h-2.296v.919h2.296z"/>
      </svg>
      <h2>LINE ÂÆòÊñπÊúçÂãô</h2>
    </div>
    <div class="line-body">
      <p>ÊàëÂÄë‰πüÂú® LINE ‰∏äÁÇ∫ÊÇ®Êèê‰æõÊúçÂãôÔºÅ<br>Á´ãÂàªÂä†ÂÖ•Â•ΩÂèãÔºåÈö®ÊôÇÈö®Âú∞Êé•Êî∂ÊúÄÊñ∞Ë≤°Á∂ìÊñ∞ËÅûÊëòË¶Å„ÄÇ</p>
      
      <div class="qr-box">
        <!-- Âú®ÈÄôË£°Êîæ‰∏äÊÇ®ÁöÑÂØ¶Èöõ QR Code ÂúñÁâáÁ∂≤ÂùÄ -->
        <img src="https://qr-official.line.me/gs/M_351pxsjv_GW.png?oat_content=qr" alt="LINE QR Code" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'180\' height=\'180\'><rect width=\'180\' height=\'180\' fill=\'%23eee\'/><text x=\'50%\' y=\'50%\' fill=\'%23999\' font-family=\'sans-serif\' font-size=\'14\' text-anchor=\'middle\' alignment-baseline=\'middle\'>Ë´ãÊõøÊèõÁÇ∫ÊÇ®ÁöÑ QR Code</text></svg>'">
      </div>
      
      <p style="font-size: 12px; color: #888; margin-top: 10px; margin-bottom: 0;">ÊâìÈñã LINE ÊéÉÊèè QR Code Á´ãÂç≥Á∂ÅÂÆö</p>
    </div>
  </div>
</div>

<script>
  const API_BASE = 'https://newsbot.aryhsg.com';
  
  const CATEGORIES = [
    'Ë¶ÅËÅû','ÂúãÈöõ','Ë≠âÂà∏','ÊúüË≤®','ÁêÜË≤°','ÊàøÂ∏Ç',
    'ÂÖ©Â≤∏','ÈáëËûç','Â∞àÊ¨Ñ','Â∞àÈ°å','ÂïÜÊÉÖ','Áî¢Ê•≠'
  ];

  let allNews = [];
  let currentCategory = '';
  let searchQuery = '';
  let currentNews = null;

  // Init
  function init() {
    renderSidebar();
    fetchNewsList();
    setupEvents();
  }

  function renderSidebar() {
    const container = document.getElementById('navContainer');
    let html = `
      <div class="nav-group-title">Menu</div>
      <button class="nav-item active" onclick="setCategory('')" id="nav-all">
        <span>All News</span>
        <span class="nav-item-count" id="cnt-all">0</span>
      </button>
      <div class="nav-group-title">Categories</div>
    `;
    
    CATEGORIES.forEach(cat => {
      html += `
        <button class="nav-item" onclick="setCategory('${cat}')" id="nav-${cat}">
          <span>${cat}</span>
          <span class="nav-item-count" id="cnt-${cat}">0</span>
        </button>
      `;
    });
    container.innerHTML = html;
  }

  async function fetchNewsList() {
    const grid = document.getElementById('newsGrid');
    grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:50px;"><span class="loader"></span></div>';
    
    try {
      const res = await fetch(`${API_BASE}/api/news`);
      if(!res.ok) throw new Error();
      allNews = await res.json();
      updateCounts();
      renderGrid(allNews); 
    } catch(e) {
      grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#666;">Failed to load data.</div>';
    }
  }

  function updateCounts() {
    document.getElementById('cnt-all').innerText = allNews.length;
    CATEGORIES.forEach(cat => {
      const cnt = allNews.filter(n => n.category === cat).length;
      document.getElementById(`cnt-${cat}`).innerText = cnt;
    });
  }

  function renderGrid(dataSource) {
    const grid = document.getElementById('newsGrid');
    const filtered = (dataSource || allNews).filter(n => {
      const matchCat = !currentCategory || n.category === currentCategory;
      const matchSearch = (dataSource === allNews && searchQuery) 
        ? n.title.includes(searchQuery) 
        : true;
        
      return matchCat && matchSearch;
    });

    document.getElementById('pageTitle').innerText = currentCategory ? currentCategory : 'DASHBOARD';

    if(filtered.length === 0) {
      grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:50px;color:#666;">ÁõÆÂâçÂ∞öÁÑ°Êñ∞ËÅû</div>';
      return;
    }

    grid.innerHTML = filtered.map(news => {
      const img = news.img || '';
      const fallback = `<div style="width:100%;height:100%;background:#222;display:flex;align-items:center;justify-content:center;color:#444;font-weight:900;font-size:30px;">${news.category[0]}</div>`;
      const imgHtml = img ? `<img src="${esc(img)}" onerror="this.parentElement.innerHTML='${esc(fallback)}'">` : fallback;

      return `
        <div class="trend-card" onclick="openModal(${news.id})">
          <div class="card-header">
            <div class="card-title">${esc(news.title)}</div>
            <div class="card-arrow">‚ûî</div>
          </div>
          <div class="card-img-wrap">
            ${imgHtml}
          </div>
          <div class="card-meta">
            <span class="cat-pill">${news.category}</span>
            <span>ID: ${news.id}</span>
          </div>
        </div>
      `;
    }).join('');
  }

  window.setCategory = function(cat) {
    currentCategory = cat;
    
    searchQuery = '';
    document.getElementById('searchInput').value = '';

    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    if(cat === '') document.getElementById('nav-all').classList.add('active');
    else document.getElementById(`nav-${cat}`).classList.add('active');

    const toggle = document.getElementById('summaryToggle');
    if(cat === '') {
      toggle.classList.remove('visible');
      closeDrawer();
    } else {
      toggle.classList.add('visible');
      updateDrawerContent(cat);
    }

    renderGrid(allNews);
  };

  async function updateDrawerContent(cat) {
    const content = document.getElementById('drawerContent');
    
    content.innerHTML = `
      <div style="text-align:center; padding:40px;">
        <span class="loader"></span>
        <div style="margin-top:16px; color:#888;">Analyzing ${esc(cat)} news...</div>
      </div>
    `;

    try {
      const res = await fetch(`${API_BASE}/api/news/summary/${encodeURIComponent(cat)}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      });

      if (!res.ok) throw new Error('API Error');
      const data = await res.json();
      const summaryText = data.summary || "Êö´ÁÑ°ÊëòË¶ÅË≥áÊñô";

      content.innerHTML = `
        <div class="summary-box" style="border:1px solid var(--primary); background:rgba(255,94,20,0.05);">
          <span class="summary-label">AI Analysis Report</span>
          <div class="summary-text">${summaryText}</div>
        </div>
        
        <div class="summary-box">
          <span class="summary-label">Category Stats</span>
          <div class="summary-text">
            Total Articles: <strong>${allNews.filter(n=>n.category===cat).length}</strong><br>
            Status: <strong>Live</strong>
          </div>
        </div>
      `;
    } catch (e) {
      content.innerHTML = `
        <div class="summary-box" style="border-color:#555;">
          <span class="summary-label">System Message</span>
          <div class="summary-text" style="color:#aaa;">
            ÁõÆÂâçÁÑ°Ê≥ïÂèñÂæóÊëòË¶Å„ÄÇ<br>ÂèØËÉΩÊòØ API Â∞öÊú™ÈÄ£Á∑öÊàñË©≤È°ûÂà•Ë≥áÊñô‰∏çË∂≥„ÄÇ
          </div>
        </div>
      `;
    }
  }

  const drawer = document.getElementById('summaryDrawer');
  const toggleBtn = document.getElementById('summaryToggle');
  
  toggleBtn.onclick = () => drawer.classList.add('open');
  document.getElementById('drawerClose').onclick = closeDrawer;

  function closeDrawer() {
    drawer.classList.remove('open');
  }

  // --- MODAL ---
  window.openModal = async function(id) {
    const news = allNews.find(n => n.id === id);
    if(!news) return;
    currentNews = news;

    const overlay = document.getElementById('modalOverlay');
    const body = document.getElementById('modalBody');
    const btn = document.getElementById('btnSummarize');
    const summaryPopup = document.getElementById('summaryPopup');
    
    btn.innerText = 'GENERATE AI REPORT';
    btn.disabled = false;
    summaryPopup.style.display = 'none';
    
    document.getElementById('modalTitle').innerText = news.title;
    document.getElementById('modalCat').innerText = news.category;
    
    body.innerHTML = '<div style="text-align:center;padding:50px;"><span class="loader"></span></div>';
    overlay.classList.add('active');

    try {
      const res = await fetch(`${API_BASE}/api/news/${id}`);
      const data = await res.json();
      
      const imgHtml = data.img ? `<img class="modal-img" src="${esc(data.img)}">` : '';
      
      body.innerHTML = `
        ${imgHtml}
        <div class="modal-content">
          ${data.content || 'Content unavailable.'}
        </div>
      `;
    } catch(e) {
      body.innerHTML = '<div style="padding:40px;text-align:center;">Error loading content.</div>';
    }
  }

  document.getElementById('modalClose').onclick = () => {
    document.getElementById('modalOverlay').classList.remove('active');
  };
  
  document.addEventListener('keydown', (e) => {
    if(e.key === 'Escape') {
      document.getElementById('modalOverlay').classList.remove('active');
      document.getElementById('lineModalOverlay').classList.remove('active');
      closeDrawer();
    }
  });

  // --- SEARCH ---
  let timer;
  document.getElementById('searchInput').addEventListener('input', (e) => {
    clearTimeout(timer);
    const query = e.target.value.trim();
    searchQuery = query;

    timer = setTimeout(async () => {
      if (query.length > 0) {
        const grid = document.getElementById('newsGrid');
        grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:50px;"><span class="loader"></span></div>';
        
        try {
          const res = await fetch(`${API_BASE}/api/news/search?q=${encodeURIComponent(query)}`);
          if (!res.ok) throw new Error('Search API Error');
          const searchResults = await res.json();
          renderGrid(searchResults);
        } catch (error) {
          console.warn('Search API failed, falling back to client filter', error);
          renderGrid(allNews); 
        }
      } else {
        renderGrid(allNews);
      }
    }, 500);
  });

  // --- AI SUMMARY ---
  document.getElementById('btnSummarize').onclick = async function() {
    if(!currentNews) return;
    
    const btn = this;
    const originalText = btn.innerText;
    
    btn.innerText = 'GENERATING SUMMARY...';
    btn.disabled = true;

    try {
      const response = await fetch(`${API_BASE}/api/news/${currentNews.id}/summary`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      });

      if (!response.ok) throw new Error('API Error');

      const data = await response.json();
      const summaryText = data.summary || data.text || "Summary generated successfully.";

      const summaryPopup = document.getElementById('summaryPopup');
      const summaryBody = document.getElementById('summaryPopupBody');
      
      summaryBody.innerHTML = summaryText; 
      summaryPopup.style.display = 'flex';
      
      btn.innerText = 'REPORT GENERATED';

    } catch (error) {
      console.error('Summary Generation Failed:', error);
      btn.innerText = 'GENERATION FAILED';
      btn.disabled = false;
      setTimeout(() => btn.innerText = originalText, 2000);
    }
  };
  
  // --- [NEW] LINE Modal Events ---
  function setupEvents() {
    const lineBtn = document.getElementById('btnOpenLine');
    const lineModal = document.getElementById('lineModalOverlay');
    const lineClose = document.getElementById('lineModalClose');

    // Open LINE Modal
    lineBtn.onclick = () => {
      lineModal.classList.add('active');
    };

    // Close LINE Modal on X click
    lineClose.onclick = () => {
      lineModal.classList.remove('active');
    };

    // Close LINE Modal on outside click
    lineModal.onclick = (e) => {
      if(e.target === lineModal) {
        lineModal.classList.remove('active');
      }
    };
  }

  function esc(s) {
    return s ? s.toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') : '';
  }

  init();
</script>
</body>
</html>